from flask import Flask, request, render_template_string, redirect, send_from_directory
import os
import hashlib

app = Flask(__name__)

# Извлечь адрес электронной почты из переменной окружения
email = os.getenv('USER', 'student_user')

# Сгенерировать флаг на основе электронной почты
def generate_flag(email):
    return hashlib.sha256(email.encode()).hexdigest()

ctf = generate_flag(email)

@app.route('/')
def index():
    name = request.args.get('name', '')
    template = '''
    <html lang="en">
      <head>
        <meta charset="utf-8">
        <title>XSS</title>
        <link rel="stylesheet" type="text/css" href="/static/styles.css">
      </head>
      <body>
      <div class="container">
        <h1>Use an XSS vulnerability to find the flag</h1> <br>
        <h1>Welcome, {}!</h1> <br>
        <p>Input text in URL parameter "name", for example, <a href="/?name=Alex">/?name=Alex</a></p>
      </div>
      </body>
    </html>
    '''
    return render_template_string(template.format(name))

@app.route('/get_flag', methods=['POST'])
def get_flag():
    # Проверяем, что POST-запрос содержит правильный ключ
    if request.form.get('key') == 'secret_key':
        # Если ключ правильный, возвращаем флаг
        return ctf
     # Если ключ неправильный, перенаправляем на главную страницу
    return redirect('/')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
